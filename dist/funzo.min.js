"use strict";function Funzo(data){return new FunzoData(data)}function wrapArray(data,accessorFunc){return new FunzoList(accessorFunc?accessorFunc:function(x){return x},data)}var FunzoList=function(){function FunzoList(accessorFunc,data){this.accessorFunc=accessorFunc,this.data=data}return FunzoList.prototype.toString=function(){return"[object FunzoList]"},FunzoList.prototype.size=function(){return this.data.length},FunzoList.prototype.get=function(idx){return this.accessorFunc(this.data[idx])},FunzoList.prototype.set=function(idx,v){this.data[idx]=v},FunzoList.prototype.toArray=function(){return this.data.map(this.accessorFunc)},FunzoList.prototype.each=function(fn){for(var i=0;i<this.data.length&&fn.call(this,this.get(i),i)!==!1;i+=1);},FunzoList.prototype.sum=function(){for(var total=0,i=0;i<this.size();i+=1){var x=this.get(i);if("number"!=typeof x)return NaN;total+=x}return total},FunzoList.prototype.max=function(){for(var maxVal=this.get(0),i=1;i<this.size();i+=1){var x=this.get(i);if("number"!=typeof x)return NaN;x>maxVal&&(maxVal=x)}return maxVal},FunzoList.prototype.min=function(){for(var minVal=this.get(0),i=1;i<this.size();i+=1){var x=this.get(i);if("number"!=typeof x)return NaN;minVal>x&&(minVal=x)}return minVal},FunzoList.prototype.mean=function(){return this.size()>0?this.sum()/this.size():NaN},FunzoList.prototype.stdev=function(){var mean=this.mean(),curr=0;if(!isNaN(mean)&&this.size()>1){for(var i=0;i<this.size();i+=1)curr+=(this.get(i)-mean)*(this.get(i)-mean);return Math.sqrt(curr/(this.size()-1))}return NaN},FunzoList.prototype.correl=function(otherData){var len=Math.min(this.size(),otherData.size()),numerator=0,denominator1=0,denominator2=0;if(otherData instanceof FunzoData)throw new Error("Please apply map() to the argument");if(this.size()===otherData.size()){for(var m1=this.mean(),m2=otherData.mean(),i=0;len>i;i+=1)numerator+=(this.get(i)-m1)*(otherData.get(i)-m2),denominator1+=(this.get(i)-m1)*(this.get(i)-m1),denominator2+=(otherData.get(i)-m2)*(otherData.get(i)-m2);return numerator/Math.sqrt(denominator1*denominator2)}return NaN},FunzoList.prototype.median=function(){function swap(i,j){var tmp=self.data[i];self.data[i]=self.data[j],self.data[j]=tmp}function partition(left,right,pivotIdx){var pivotValue=self.get(pivotIdx),realPivotIdx=left;swap(pivotIdx,right);for(var i=left;right>=i;i+=1)self.get(i)<pivotValue&&(swap(i,realPivotIdx),realPivotIdx+=1);return swap(right,realPivotIdx),realPivotIdx}function quickSelect(n){for(var pivotIdx,left=0,right=self.size()-1;;){if(left==right)return self.get(left);if(pivotIdx=Math.floor((left+right)/2),pivotIdx=partition(left,right,pivotIdx),n==pivotIdx)return self.get(n);pivotIdx>n?right=pivotIdx-1:left=pivotIdx+1}}var self=this;if(0===this.size())return NaN;var m2,halfIdx=Math.floor(self.size()/2),m=quickSelect(halfIdx);return self.size()%2==0?(m2=quickSelect(halfIdx-1),(m2+m)/2):m},FunzoList.prototype.entropy=function(base){for(var tmp,ans=0,i=0;i<this.size();i+=1){if(tmp=this.get(i),0>tmp||tmp>1)return NaN;ans+=tmp*Math.log(tmp)}return-ans/Math.log(base)},FunzoList.prototype.joint=function(otherData){return new FunzoJointData(this,otherData)},FunzoList}(),FunzoData=function(){function FunzoData(data){this.data=data}return FunzoData.prototype.map=function(fn){return new FunzoList(fn?fn:function(x){return x},this.data)},FunzoData.prototype.numerize=function(fallbackValue){function convert(v){return"number"==typeof v?v:"string"!=typeof v||isNaN(parseFloat(v))?fallbackValue:parseFloat(v)}return void 0===fallbackValue&&(fallbackValue=0),new FunzoList(convert,this.data)},FunzoData.prototype.round=function(places){function convert(v){return parseFloat(v.toFixed(places))}return new FunzoList(convert,this.data)},FunzoData.prototype.sample=function(size){function randomInt(fromNum,toNum){return Math.floor(Math.random()*(toNum-fromNum))+fromNum}if(0>=size||size>this.data.length)throw new Error("Sample size must be between zero and the size of the dataset");for(var i=0;size>i;i+=1){var randIdx=randomInt(i,this.data.length),tmp=this.data[i];this.data[i]=this.data[randIdx],this.data[randIdx]=tmp}return new FunzoData(this.data.slice(0,size))},FunzoData.prototype.probs=function(key){var item,probs=Object.create(null),ans=[];void 0===key&&(key=function(x){return x});for(var i=0;i<this.data.length;i+=1)item=key(this.data[i]),probs[item]=void 0!==probs[item]?probs[item]+1:1;for(var p in probs)ans.push(probs[p]/this.data.length);return new FunzoList(function(x){return x},ans)},FunzoData}();exports.FunzoData=FunzoData;var FunzoJointData=function(){function FunzoJointData(list1,list2){this.list1=list1,this.list2=list2}return FunzoJointData.prototype.mi=function(base){for(var probs12=Object.create(null),probs1=Object.create(null),probs2=Object.create(null),limit=Math.min(this.list1.size(),this.list2.size()),i=0;limit>i;i+=1){var v1=String(this.list1.get(i)),v2=String(this.list2.get(i)),v1v2=v1+":"+v2;probs12[v1v2]=void 0!==probs12[v1v2]?probs12[v1v2]+1:1,probs1[v1]=void 0!==probs1[v1]?probs1[v1]+1:1,probs2[v2]=void 0!==probs2[v2]?probs2[v2]+1:1}for(var ans=0,pairs=Object.keys(probs12),i=0;i<pairs.length;i+=1){var vals=pairs[i].split(":");ans+=probs12[pairs[i]]/pairs.length*Math.log(probs12[pairs[i]]/pairs.length/(probs1[vals[0]]/limit*(probs2[vals[1]]/limit)))}return ans/Math.log(base)},FunzoJointData}();exports.FunzoJointData=FunzoJointData,exports.Funzo=Funzo,exports.wrapArray=wrapArray;